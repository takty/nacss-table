{"version":3,"sources":["table-usable-view.js"],"names":["window","NS","setScrollPaddingTop","key","val","de","document","documentElement","at","getAttribute","vs","Map","split","map","e","set","delete","newAt","join","setAttribute","getScrollPaddingTop","without","filter","k","v","parseInt","reduce","a","b","setClass","tar","cls","enabled","substr","startsWith","dataset","c","classList","add","remove","throttle","fn","isRunning","args","requestAnimationFrame","resizeListeners","_createHeaderClone","tab","cm","thead","tHead","trs","tBodies","rows","length","containsOnlyTh","tr","tds","getElementsByTagName","ths","trsH","push","createTHead","appendChild","_createPseudoHeader","hc","createElement","z","style","zoom","parseFloat","styleHeaderContainer","parentNode","ht","styleHeaderTable","cloneNode","_createBarClone","bar","styleScrollBar","spacer","doResize","r","head","overflowX","scrollWidth","clientWidth","tw","width","offsetWidth","maxWidth","display","top","offset","firstChild","setProperty","offsetHeight","oTrs","cTrs","i","copyWidth","o","tag","os","cs","_updateHeaderSize","disabled","pointerEvents","h","parent","d","getComputedStyle","getPropertyValue","overflowY","minHeight","cw","removeChild","getScrollBarWidth","height","_updateScrollBarSize","onWindowScroll","onTableScroll","getBoundingClientRect","tBottom","bottom","rh","hTop","hBottom","wY0","wY1","innerHeight","inView","capableWindowHeightRate","tScrollLeft","scrollLeft","cz","f","isNaN","parentElement","getCombinedZoom","tLeft","isSafari","left","Math","round","hCy","visible","tabLeft","tabScrollLeft","_updateHeaderVisibility","_updateBarVisibility","sL","max","min","styleScrollRight","styleScrollLeft","ua","navigator","userAgent","toLowerCase","includes","addEventListener","l","passive","applyUsableView","tabs","opts","Object","assign","ts","forced","el","self","op","ro","ResizeObserver","es","idx","indexOf","target","contentRect","t","observe","maxHeadH","mo","MutationObserver","ms","update","disconnect","scrollPaddingTop","Number","attributes","initializeScrollPaddingTop","st","clearTimeout","setTimeout","doFirst","onResize"],"mappings":"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","file":"table-usable-view.min.js","sourcesContent":["/**\n * Table - Usable View\n *\n * @author Takuto Yanagida\n * @version 2022-01-06\n */\n\n'use strict';\n\nwindow['NACSS']          = window['NACSS']          || {};\nwindow['NACSS']['table'] = window['NACSS']['table'] || {};\n\n((NS) => {\n\n\t/**\n\t * Scroll Padding Top\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2025-02-19\n\t */\n\t\n\tfunction initializeScrollPaddingTop() {\n\t\tconst de = document.documentElement;\n\t\tif (de.getAttribute('data-scroll-padding-top') !== null) return;\n\t\tde.setAttribute('data-scroll-padding-top', '');\n\t\n\t\tconst mo = new MutationObserver((ms, mo) => update(mo));\n\t\tmo.observe(de, { attributes: true });\n\t\n\t\tconst ro = new ResizeObserver(() => update(mo));\n\t\tro.observe(de);\n\t\n\t\tupdate(mo);\n\t\n\t\tfunction update(mo) {\n\t\t\tconst de = document.documentElement;\n\t\n\t\t\tmo.disconnect();\n\t\t\tde.style.scrollPaddingTop = null;\n\t\n\t\t\tconst v = parseInt(getComputedStyle(de).scrollPaddingTop);\n\t\t\tsetScrollPaddingTop('default', Number.isNaN(v) ? 0 : v);\n\t\n\t\t\tde.style.scrollPaddingTop = getScrollPaddingTop() + 'px';\n\t\t\tmo.observe(de, { attributes: true });\n\t\t}\n\t}\n\t\n\tfunction setScrollPaddingTop(key, val) {\n\t\tconst de = document.documentElement;\n\t\tconst at = de.getAttribute('data-scroll-padding-top');\n\t\tconst vs = at ? new Map(at.split(',').map(e => e.split(':'))) : new Map();\n\t\tif (val) {\n\t\t\tvs.set(key, val);\n\t\t} else {\n\t\t\tvs.delete(key);\n\t\t}\n\t\tconst newAt = [...vs].map(e => e.join(':')).join(',');\n\t\tif (newAt !== at) {\n\t\t\tde.setAttribute('data-scroll-padding-top', newAt);\n\t\t}\n\t}\n\t\n\tfunction getScrollPaddingTop(without = null) {\n\t\tconst de = document.documentElement;\n\t\tconst at = de.getAttribute('data-scroll-padding-top');\n\t\tif (!at) return 0;\n\t\n\t\tconst vs = at.split(',').map(e => e.split(':')).filter(([key,]) => key !== without).map(([k, v]) => parseInt(v));\n\t\treturn vs.reduce((a, b) => a + b, 0);\n\t}\n\t\n\t/**\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t */\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t */\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n\t/**\n\t * Usable View\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2025-02-19\n\t */\n\t\n\tfunction apply(tabs, opts = {}) {\n\t\tif (tabs.length === 0) return;\n\t\tconst cm = Object.assign({\n\t\t\tcapableWindowHeightRate: 0.9,\n\t\t\tstyleHeaderContainer   : ':ncTableStickyHeaderContainer',\n\t\t\tstyleHeaderTable       : ':ncTableStickyHeaderTable',\n\t\t\tstyleScrollBar         : ':ncTableStickyScrollBar',\n\t\n\t\t\tstyleScrollRight: ':ncScrollRight',\n\t\t\tstyleScrollLeft : ':ncScrollLeft',\n\t\t\toffset          : 0,\n\t\t\tisSafari        : isSafari(),\n\t\t}, opts);\n\t\n\t\tconst cs = [], ts = [...tabs];\n\t\tfor (const tab of ts) {\n\t\t\tconst head = _createHeaderClone(tab, cm);\n\t\t\tconst bar  = _createBarClone(tab, cm);\n\t\t\tcs.push({ tab, head, bar });\n\t\n\t\t\tlet forced = null;\n\t\t\tconst el = (self, op) => throttle(() => {\n\t\t\t\tif (forced && forced !== self) {\n\t\t\t\t\tforced = null;\n\t\t\t\t} else {\n\t\t\t\t\tforced = self;\n\t\t\t\t\top.scrollLeft = self.scrollLeft;\n\t\t\t\t\tif (head) onTableScroll(tab, head, cm);\n\t\t\t\t}\n\t\t\t});\n\t\t\ttab.addEventListener('scroll', el(tab, bar));\n\t\t\tbar.addEventListener('scroll', el(bar, tab));\n\t\t}\n\t\tconst ro = new ResizeObserver((es) => {\n\t\t\tfor (const e of es) {\n\t\t\t\tconst idx = ts.indexOf(e.target);\n\t\t\t\tconst c = cs[idx];\n\t\t\t\tdoResize(e.contentRect, c.tab, c.head, c.bar, cm);\n\t\t\t}\n\t\t});\n\t\tfor (const t of ts) ro.observe(t);\n\t\n\t\twindow.addEventListener('scroll', throttle(() => {\n\t\t\tlet maxHeadH = 0;\n\t\t\tfor (const c of cs) {\n\t\t\t\tonWindowScroll(c.tab, c.head, c.bar, cm);\n\t\t\t\tmaxHeadH = Math.max(maxHeadH, c.head?.offsetHeight ?? 0);\n\t\t\t}\n\t\t\tsetScrollPaddingTop('nacss-table', maxHeadH);\n\t\t}), { passive: true });\n\t\n\t\tinitializeScrollPaddingTop();\n\t\n\t\tlet st = null;\n\t\tconst fn = () => {\n\t\t\tcm.offset = getScrollPaddingTop('nacss-table');\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tfor (const c of cs) doResize(null, c.tab, c.head, c.bar, cm);\n\t\t\t}, 100);\n\t\t};\n\t\tonResize(fn, true);\n\t\tconst mo = new MutationObserver(fn);\n\t\tmo.observe(document.documentElement, { attributes: true });\n\t}\n\t\n\tfunction _createHeaderClone(tab, cm) {\n\t\tlet thead = tab.tHead;\n\t\tif (!thead) {\n\t\t\tthead = _createPseudoHeader(tab);\n\t\t\tif (!thead) return null;\n\t\t\ttab.tHead = thead;\n\t\t}\n\t\tconst hc = document.createElement('div');\n\t\tconst z  = tab.style.zoom ? parseFloat(tab.style.zoom) : 1;\n\t\tif (z !== 1) {\n\t\t\thc.style.zoom = z;\n\t\t}\n\t\tsetClass(hc, cm.styleHeaderContainer);\n\t\ttab.parentNode.appendChild(hc);\n\t\n\t\tconst ht = document.createElement('div');\n\t\tsetClass(ht, cm.styleHeaderTable);\n\t\thc.appendChild(ht);\n\t\n\t\tht.appendChild(thead.cloneNode(true));\n\t\treturn hc;\n\t}\n\t\n\tfunction _createPseudoHeader(tab) {\n\t\tconst trs = tab.tBodies[0].rows;\n\t\tif (trs.length === 0) return null;\n\t\n\t\tfunction containsOnlyTh(tr) {\n\t\t\tconst tds = tr.getElementsByTagName('td');\n\t\t\tconst ths = tr.getElementsByTagName('th');\n\t\t\tif (tds.length === 0 && ths.length > 0) return true;\n\t\t\treturn false;\n\t\t}\n\t\tconst trsH = [];\n\t\tfor (const tr of trs) {\n\t\t\tif (!containsOnlyTh(tr)) break;\n\t\t\ttrsH.push(tr);\n\t\t}\n\t\tif (trsH.length === 0) return null;\n\t\n\t\tconst thead = tab.createTHead();\n\t\tfor (const tr of trsH) thead.appendChild(tr);\n\t\treturn thead;\n\t}\n\t\n\tfunction _createBarClone(tab, cm) {\n\t\tconst bar = document.createElement('div');\n\t\tconst z   = tab.style.zoom ? parseFloat(tab.style.zoom) : 1;\n\t\tif (z !== 1) {\n\t\t\tbar.style.zoom = z;\n\t\t}\n\t\tsetClass(bar, cm.styleScrollBar);\n\t\tconst spacer = document.createElement('div');\n\t\tbar.appendChild(spacer);\n\t\ttab.parentNode.appendChild(bar);\n\t\treturn bar;\n\t}\n\t\n\t\n\t// ---------------------------------------------------------------------\n\t\n\t\n\tfunction doResize(r, tab, head, bar, cm) {\n\t\ttab.style.overflowX = (tab.scrollWidth < tab.clientWidth + 2) ? 'hidden' : null;\n\t\n\t\tif (head) _updateHeaderSize(r, tab, head, cm);\n\t\tif (bar) _updateScrollBarSize(tab, bar);\n\t\tif (head || bar) onWindowScroll(tab, head, bar, cm);\n\t\tif (head) onTableScroll(tab, head, cm);\n\t}\n\t\n\tfunction _updateHeaderSize(r, tab, head, cm) {\n\t\tconst tw = r ? r.width : tab.offsetWidth;\n\t\thead.style.maxWidth = tw + 'px';\n\t\thead.style.display  = 'none';\n\t\thead.style.top      = cm.offset + 'px';\n\t\n\t\tconst thead = tab.tHead;\n\t\tconst ht    = head.firstChild;\n\t\n\t\thead.style.setProperty('--nc-width', `${thead.offsetWidth}px`);\n\t\thead.style.setProperty('--nc-height', `${thead.offsetHeight}px`);\n\t\n\t\tconst oTrs = thead.rows;\n\t\tconst cTrs = ht.firstChild.rows;\n\t\tfor (let i = 0; i < oTrs.length; i += 1) {\n\t\t\tcopyWidth(oTrs[i], cTrs[i], 'td');\n\t\t\tcopyWidth(oTrs[i], cTrs[i], 'th');\n\t\t}\n\t\tfunction copyWidth(o, c, tag) {\n\t\t\tconst os = o.getElementsByTagName(tag);\n\t\t\tconst cs = c.getElementsByTagName(tag);\n\t\t\tfor (let i = 0; i < os.length; i += 1) {\n\t\t\t\tcs[i].style.width = os[i].offsetWidth + 'px';\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction _updateScrollBarSize(tab, bar) {\n\t\tconst disabled = (tab.scrollWidth < tab.clientWidth + 2);\n\t\tbar.style.overflowX     = disabled ? 'hidden' : null;\n\t\tbar.style.pointerEvents = disabled ? 'none'   : null;\n\t\tbar.style.maxWidth      = `${tab.clientWidth}px`;\n\t\tbar.style.display       = 'none';\n\t\n\t\tconst h = parseInt(getScrollBarWidth(document.documentElement));\n\t\tif (0 < h) {\n\t\t\tbar.style.height = (h + 2 + 1) + 'px';\n\t\t}\n\t\tbar.firstChild.style.width = `${tab.scrollWidth}px`;\n\t}\n\t\n\t\n\t// ---------------------------------------------------------------------\n\t\n\t\n\tfunction onWindowScroll(tab, head, bar, cm) {\n\t\tconst r = tab.getBoundingClientRect();\n\t\tconst tBottom = r.bottom;\n\t\tconst rh = (tab.tHead ?? tab.tBodies[0]).getBoundingClientRect();\n\t\tconst hTop = rh.top, hBottom = rh.bottom;\n\t\tconst wY0 = cm.offset, wY1 = window.innerHeight;\n\t\n\t\tconst inView      = tBottom - hTop < cm.capableWindowHeightRate * (wY1 - wY0);\n\t\tconst tScrollLeft = tab.scrollLeft;\n\t\tconst z           = getCombinedZoom(tab);\n\t\tconst tLeft       = cm.isSafari ? r.left : Math.round(r.left / z);\n\t\n\t\tif (head) {\n\t\t\tconst hCy = tab.tHead.offsetHeight;\n\t\t\tconst f = (!inView && hTop < wY0 && wY0 < tBottom - hCy);\n\t\t\t_updateHeaderVisibility(head, f, tLeft, tScrollLeft);\n\t\t}\n\t\tif (bar) {\n\t\t\tconst f = (!inView && hBottom < wY1 && wY1 < tBottom);\n\t\t\t_updateBarVisibility(bar, f, tLeft, tScrollLeft);\n\t\t}\n\t}\n\t\n\tfunction _updateHeaderVisibility(head, visible, tabLeft, tabScrollLeft) {\n\t\thead.style.display = visible ? 'block' : 'none';\n\t\thead.style.left    = tabLeft + 'px';\n\t\thead.scrollLeft    = tabScrollLeft;\n\t}\n\t\n\tfunction _updateBarVisibility(bar, visible, tabLeft, tabScrollLeft) {\n\t\tbar.style.display = visible ? 'block' : 'none';\n\t\tbar.style.left    = tabLeft + 'px';\n\t\tbar.scrollLeft    = tabScrollLeft;\n\t}\n\t\n\t\n\t// ---------------------------------------------------------------------\n\t\n\t\n\tfunction onTableScroll(tab, head, cm) {\n\t\tconst sL = Math.max(0, Math.min(tab.scrollLeft, tab.scrollWidth - tab.offsetWidth));  // for iOS\n\t\thead.scrollLeft = sL;\n\t\n\t\tif (tab.scrollWidth - tab.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = tab.scrollLeft / (tab.scrollWidth - tab.clientWidth);\n\t\t\tsetClass(head, cm.styleScrollRight, r < 0.95);\n\t\t\tsetClass(head, cm.styleScrollLeft, 0.05 < r);\n\t\t} else {\n\t\t\tsetClass(head, cm.styleScrollRight, false);\n\t\t\tsetClass(head, cm.styleScrollLeft, false);\n\t\t}\n\t}\n\t\n\t\n\t// Utilities ---------------------------------------------------------------\n\t\n\t\n\tfunction getScrollBarWidth(parent) {\n\t\tconst d = document.createElement('div');\n\t\td.setAttribute('style', 'position:absolute;bottom:100%;width:calc(100vw - 100%);height:1px;');\n\t\tparent.appendChild(d);\n\t\tlet width = 0 | window.getComputedStyle(d).getPropertyValue('width');\n\t\n\t\tif (width === 0) {  // Window does not have any scroll bar\n\t\t\td.style.overflowY = 'scroll';\n\t\t\td.style.width = '';\n\t\t\tconst c = document.createElement('div');\n\t\t\tc.style.minHeight = '100px';\n\t\t\td.appendChild(c);\n\t\t\tconst cw = 0 | window.getComputedStyle(c).getPropertyValue('width');\n\t\t\twidth = d.offsetWidth - cw;\n\t\t}\n\t\tparent.removeChild(d);\n\t\treturn width;\n\t}\n\t\n\tfunction getCombinedZoom(e) {\n\t\tlet cz = 1;\n\t\n\t\twhile (e) {\n\t\t\tconst s = window.getComputedStyle(e);\n\t\t\tconst z = s.zoom;\n\t\n\t\t\tif (z && z !== 'normal') {\n\t\t\t\tconst f = parseFloat(z);\n\t\t\t\tif (!isNaN(f)) {\n\t\t\t\t\tcz *= f;\n\t\t\t\t}\n\t\t\t}\n\t\t\te = e.parentElement;\n\t\t}\n\t\treturn cz;\n\t}\n\t\n\t// function getUnZoomedCoordinates(e) {\n\t// \tconst docR = document.documentElement.getBoundingClientRect();\n\t// \tconst zg   = docR.width / document.documentElement.clientWidth;\n\t\n\t// \tlet zl  = 1;\n\t// \tlet cur = e;\n\t\n\t// \tconst es = window.getComputedStyle(e);\n\t// \tif (es.position === 'fixed') {\n\t// \t\tzl = parseFloat(es.zoom) || 1;\n\t// \t} else {\n\t// \t\twhile (cur && cur !== document.documentElement) {\n\t// \t\t\tconst s = window.getComputedStyle(cur);\n\t// \t\t\tconst z = parseFloat(s.zoom) || 1;\n\t// \t\t\tzl *= z;\n\t// \t\t\tcur = cur.parentElement;\n\t// \t\t}\n\t// \t}\n\t// \tconst zt = zg * zl;\n\t// \tconst r  = e.getBoundingClientRect();\n\t// \treturn {\n\t// \t\ttop   : r.top    / zt,\n\t// \t\tleft  : r.left   / zt,\n\t// \t\tbottom: r.bottom / zt,\n\t// \t\tright : r.right  / zt,\n\t// \t\twidth : r.width  / zt,\n\t// \t\theight: r.height / zt\n\t// \t};\n\t// }\n\t// function getUnZoomedCoordinates(elem) {\n\t// \tconst elemStyle = window.getComputedStyle(elem);\n\t// \tconst isFixed = elemStyle.position === 'fixed';\n\t\n\t// \t// グローバルズームの取得\n\t// \tlet globalZoom;\n\t// \tif (isFixed && window.visualViewport && window.visualViewport.scale) {\n\t// \t  // Safari などで固定要素の場合は、visualViewport.scale を利用\n\t// \t  globalZoom = window.visualViewport.scale;\n\t// \t} else {\n\t// \t  // 通常は、document.documentElement の getBoundingClientRect() と clientWidth の比率から求める\n\t// \t  const docRect = document.documentElement.getBoundingClientRect();\n\t// \t  globalZoom = docRect.width / document.documentElement.clientWidth;\n\t// \t}\n\t\n\t// \t// 局所ズームの取得\n\t// \tlet localZoom = 1;\n\t// \tif (isFixed) {\n\t// \t  // fixed の場合は、要素自身の zoom のみを補正に使う\n\t// \t  localZoom = parseFloat(elemStyle.zoom) || 1;\n\t// \t} else {\n\t// \t  // fixed 以外の場合は、対象要素から document.documentElement までの各要素の zoom を掛け合わせる\n\t// \t  let current = elem;\n\t// \t  while (current && current !== document.documentElement) {\n\t// \t\tconst style = window.getComputedStyle(current);\n\t// \t\tlocalZoom *= (parseFloat(style.zoom) || 1);\n\t// \t\tcurrent = current.parentElement;\n\t// \t  }\n\t// \t}\n\t\n\t// \tconst totalZoom = globalZoom * localZoom;\n\t\n\t// \tconst rect = elem.getBoundingClientRect();\n\t\n\t// \treturn {\n\t// \t  top: rect.top / totalZoom,\n\t// \t  left: rect.left / totalZoom,\n\t// \t  bottom: rect.bottom / totalZoom,\n\t// \t  right: rect.right / totalZoom,\n\t// \t  width: rect.width / totalZoom,\n\t// \t  height: rect.height / totalZoom\n\t// \t};\n\t//   }\n\t\n\tfunction isSafari() {\n\t\tconst ua = window.navigator.userAgent.toLowerCase();\n\t\tif (ua.includes('chrome')) {  // UA includes 'safari'.\n\t\t\treturn false;\n\t\t}\n\t\tif (ua.includes('safari')) {\n\t\t\treturn true;\n\t\t}\n\t\tfalse;\n\t}\n\t\n\tNS.applyUsableView = apply;\n\n})(window['NACSS']['table']);\n"]}