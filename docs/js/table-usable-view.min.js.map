{"version":3,"sources":["table-usable-view.js"],"names":["window","NS","setScrollPaddingTop","key","val","de","document","documentElement","at","getAttribute","vs","Map","split","map","e","set","delete","newAt","join","setAttribute","getScrollPaddingTop","without","filter","k","v","parseInt","reduce","a","b","setClass","tar","cls","enabled","substr","startsWith","dataset","c","classList","add","remove","throttle","fn","isRunning","args","requestAnimationFrame","resizeListeners","_createHeaderClone","tab","cm","thead","tHead","trs","tBodies","rows","length","containsOnlyTh","tr","tds","getElementsByTagName","ths","trsH","push","createTHead","appendChild","_createPseudoHeader","hc","createElement","styleHeaderContainer","parentNode","ht","styleHeaderTable","cloneNode","_createBarClone","bar","styleScrollBar","spacer","doResize","r","head","style","overflowX","scrollWidth","clientWidth","tw","width","offsetWidth","maxWidth","display","top","offset","firstChild","setProperty","offsetHeight","oTrs","cTrs","i","copyWidth","o","tag","os","cs","_updateHeaderSize","disabled","pointerEvents","h","parent","d","getComputedStyle","getPropertyValue","overflowY","minHeight","cw","removeChild","getScrollBarWidth","height","_updateScrollBarSize","onWindowScroll","onTableScroll","getBoundingClientRect","tBottom","bottom","rh","hTop","hBottom","wY0","wY1","innerHeight","inView","capableWindowHeightRate","tLeft","left","tScrollLeft","scrollLeft","hCy","visible","tabLeft","tabScrollLeft","_updateHeaderVisibility","_updateBarVisibility","sL","Math","max","min","styleScrollRight","styleScrollLeft","addEventListener","l","passive","applyUsableView","tabs","opts","Object","assign","ts","forced","el","self","op","ro","ResizeObserver","es","idx","indexOf","target","contentRect","t","observe","maxHeadH","mo","MutationObserver","ms","update","disconnect","scrollPaddingTop","Number","isNaN","attributes","initializeScrollPaddingTop","st","clearTimeout","setTimeout","doFirst","onResize"],"mappings":"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","file":"table-usable-view.min.js","sourcesContent":["/**\n * Table - Usable View\n *\n * @author Takuto Yanagida\n * @version 2022-01-06\n */\n\n'use strict';\n\nwindow['NACSS']          = window['NACSS']          || {};\nwindow['NACSS']['table'] = window['NACSS']['table'] || {};\n\n((NS) => {\n\n\t/**\n\t * Scroll Padding Top\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-02-23\n\t */\n\t\n\tfunction initializeScrollPaddingTop() {\n\t\tconst de = document.documentElement;\n\t\tif (de.getAttribute('data-scroll-padding-top') !== null) return;\n\t\tde.setAttribute('data-scroll-padding-top', '');\n\t\n\t\tconst mo = new MutationObserver((ms, mo) => update(mo));\n\t\tmo.observe(de, { attributes: true });\n\t\tupdate(mo);\n\t\n\t\tfunction update(mo) {\n\t\t\tconst de = document.documentElement;\n\t\n\t\t\tmo.disconnect();\n\t\t\tde.style.scrollPaddingTop = null;\n\t\n\t\t\tconst v = parseInt(getComputedStyle(de).scrollPaddingTop);\n\t\t\tsetScrollPaddingTop('default', Number.isNaN(v) ? 0 : v);\n\t\n\t\t\tde.style.scrollPaddingTop = getScrollPaddingTop() + 'px';\n\t\t\tmo.observe(de, { attributes: true });\n\t\t}\n\t}\n\t\n\tfunction setScrollPaddingTop(key, val) {\n\t\tconst de = document.documentElement;\n\t\tconst at = de.getAttribute('data-scroll-padding-top');\n\t\tconst vs = at ? new Map(at.split(',').map(e => e.split(':'))) : new Map();\n\t\tif (val) {\n\t\t\tvs.set(key, val);\n\t\t} else {\n\t\t\tvs.delete(key);\n\t\t}\n\t\tconst newAt = [...vs].map(e => e.join(':')).join(',');\n\t\tif (newAt !== at) {\n\t\t\tde.setAttribute('data-scroll-padding-top', newAt);\n\t\t}\n\t}\n\t\n\tfunction getScrollPaddingTop(without = null) {\n\t\tconst de = document.documentElement;\n\t\tconst at = de.getAttribute('data-scroll-padding-top');\n\t\tif (!at) return 0;\n\t\n\t\tconst vs = at.split(',').map(e => e.split(':')).filter(([key,]) => key !== without).map(([k, v]) => parseInt(v));\n\t\treturn vs.reduce((a, b) => a + b, 0);\n\t}\n\t\n\t/**\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t */\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t */\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\n\t/**\n\t * Usable View\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2023-03-01\n\t */\n\t\n\tfunction apply(tabs, opts = {}) {\n\t\tif (tabs.length === 0) return;\n\t\tconst cm = Object.assign({\n\t\t\tcapableWindowHeightRate: 0.9,\n\t\t\tstyleHeaderContainer   : ':ncTableStickyHeaderContainer',\n\t\t\tstyleHeaderTable       : ':ncTableStickyHeaderTable',\n\t\t\tstyleScrollBar         : ':ncTableStickyScrollBar',\n\t\n\t\t\tstyleScrollRight: ':ncScrollRight',\n\t\t\tstyleScrollLeft : ':ncScrollLeft',\n\t\t\toffset          : 0,\n\t\t}, opts);\n\t\n\t\tconst cs = [], ts = [...tabs];\n\t\tfor (const tab of ts) {\n\t\t\tconst head = _createHeaderClone(tab, cm);\n\t\t\tconst bar  = _createBarClone(tab, cm);\n\t\t\tcs.push({ tab, head, bar });\n\t\n\t\t\tlet forced = null;\n\t\t\tconst el = (self, op) => throttle(() => {\n\t\t\t\tif (forced && forced !== self) {\n\t\t\t\t\tforced = null;\n\t\t\t\t} else {\n\t\t\t\t\tforced = self;\n\t\t\t\t\top.scrollLeft = self.scrollLeft;\n\t\t\t\t\tif (head) onTableScroll(tab, head, cm);\n\t\t\t\t}\n\t\t\t});\n\t\t\ttab.addEventListener('scroll', el(tab, bar));\n\t\t\tbar.addEventListener('scroll', el(bar, tab));\n\t\t}\n\t\tconst ro = new ResizeObserver((es) => {\n\t\t\tfor (const e of es) {\n\t\t\t\tconst idx = ts.indexOf(e.target);\n\t\t\t\tconst c = cs[idx];\n\t\t\t\tdoResize(e.contentRect, c.tab, c.head, c.bar, cm);\n\t\t\t}\n\t\t});\n\t\tfor (const t of ts) ro.observe(t);\n\t\n\t\twindow.addEventListener('scroll', throttle(() => {\n\t\t\tlet maxHeadH = 0;\n\t\t\tfor (const c of cs) {\n\t\t\t\tonWindowScroll(c.tab, c.head, c.bar, cm);\n\t\t\t\tmaxHeadH = Math.max(maxHeadH, c.head?.offsetHeight ?? 0);\n\t\t\t}\n\t\t\tsetScrollPaddingTop('nacss-table', maxHeadH);\n\t\t}), { passive: true });\n\t\n\t\tinitializeScrollPaddingTop();\n\t\n\t\tlet st = null;\n\t\tconst fn = () => {\n\t\t\tcm.offset = getScrollPaddingTop('nacss-table');\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tfor (const c of cs) doResize(null, c.tab, c.head, c.bar, cm);\n\t\t\t}, 100);\n\t\t};\n\t\tonResize(fn, true);\n\t\tconst mo = new MutationObserver(fn);\n\t\tmo.observe(document.documentElement, { attributes: true });\n\t}\n\t\n\tfunction _createHeaderClone(tab, cm) {\n\t\tlet thead = tab.tHead;\n\t\tif (!thead) {\n\t\t\tthead = _createPseudoHeader(tab);\n\t\t\tif (!thead) return null;\n\t\t\ttab.tHead = thead;\n\t\t}\n\t\tconst hc = document.createElement('div');\n\t\tsetClass(hc, cm.styleHeaderContainer);\n\t\ttab.parentNode.appendChild(hc);\n\t\n\t\tconst ht = document.createElement('div');\n\t\tsetClass(ht, cm.styleHeaderTable);\n\t\thc.appendChild(ht);\n\t\n\t\tht.appendChild(thead.cloneNode(true));\n\t\treturn hc;\n\t}\n\t\n\tfunction _createPseudoHeader(tab) {\n\t\tconst trs = tab.tBodies[0].rows;\n\t\tif (trs.length === 0) return null;\n\t\n\t\tfunction containsOnlyTh(tr) {\n\t\t\tconst tds = tr.getElementsByTagName('td');\n\t\t\tconst ths = tr.getElementsByTagName('th');\n\t\t\tif (tds.length === 0 && ths.length > 0) return true;\n\t\t\treturn false;\n\t\t}\n\t\tconst trsH = [];\n\t\tfor (const tr of trs) {\n\t\t\tif (!containsOnlyTh(tr)) break;\n\t\t\ttrsH.push(tr);\n\t\t}\n\t\tif (trsH.length === 0) return null;\n\t\n\t\tconst thead = tab.createTHead();\n\t\tfor (const tr of trsH) thead.appendChild(tr);\n\t\treturn thead;\n\t}\n\t\n\tfunction _createBarClone(tab, cm) {\n\t\tconst bar = document.createElement('div');\n\t\tsetClass(bar, cm.styleScrollBar);\n\t\tconst spacer = document.createElement('div');\n\t\tbar.appendChild(spacer);\n\t\ttab.parentNode.appendChild(bar);\n\t\treturn bar;\n\t}\n\t\n\t\n\t// ---------------------------------------------------------------------\n\t\n\t\n\tfunction doResize(r, tab, head, bar, cm) {\n\t\ttab.style.overflowX = (tab.scrollWidth < tab.clientWidth + 2) ? 'hidden' : null;\n\t\n\t\tif (head) _updateHeaderSize(r, tab, head, cm);\n\t\tif (bar) _updateScrollBarSize(tab, bar);\n\t\tif (head || bar) onWindowScroll(tab, head, bar, cm);\n\t\tif (head) onTableScroll(tab, head, cm);\n\t}\n\t\n\tfunction _updateHeaderSize(r, tab, head, cm) {\n\t\tconst tw = r ? r.width : tab.offsetWidth;\n\t\thead.style.maxWidth = tw + 'px';\n\t\thead.style.display  = 'none';\n\t\thead.style.top      = cm.offset + 'px';\n\t\n\t\tconst thead = tab.tHead;\n\t\tconst ht    = head.firstChild;\n\t\n\t\thead.style.setProperty('--nc-width', `${thead.offsetWidth}px`);\n\t\thead.style.setProperty('--nc-height', `${thead.offsetHeight}px`);\n\t\n\t\tconst oTrs = thead.rows;\n\t\tconst cTrs = ht.firstChild.rows;\n\t\tfor (let i = 0; i < oTrs.length; i += 1) {\n\t\t\tcopyWidth(oTrs[i], cTrs[i], 'td');\n\t\t\tcopyWidth(oTrs[i], cTrs[i], 'th');\n\t\t}\n\t\tfunction copyWidth(o, c, tag) {\n\t\t\tconst os = o.getElementsByTagName(tag);\n\t\t\tconst cs = c.getElementsByTagName(tag);\n\t\t\tfor (let i = 0; i < os.length; i += 1) {\n\t\t\t\tcs[i].style.width = os[i].offsetWidth + 'px';\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction _updateScrollBarSize(tab, bar) {\n\t\tconst disabled = (tab.scrollWidth < tab.clientWidth + 2);\n\t\tbar.style.overflowX     = disabled ? 'hidden' : null;\n\t\tbar.style.pointerEvents = disabled ? 'none'   : null;\n\t\tbar.style.maxWidth      = `${tab.clientWidth}px`;\n\t\tbar.style.display       = 'none';\n\t\n\t\tconst h = parseInt(getScrollBarWidth(document.documentElement));\n\t\tif (0 < h) {\n\t\t\tbar.style.height = (h + 2 + 1) + 'px';\n\t\t}\n\t\tbar.firstChild.style.width = `${tab.scrollWidth}px`;\n\t}\n\t\n\t\n\t// ---------------------------------------------------------------------\n\t\n\t\n\tfunction onWindowScroll(tab, head, bar, cm) {\n\t\tconst r = tab.getBoundingClientRect();\n\t\tconst tBottom = r.bottom;\n\t\tconst rh = (tab.tHead ?? tab.tBodies[0]).getBoundingClientRect();\n\t\tconst hTop = rh.top, hBottom = rh.bottom;\n\t\tconst wY0 = cm.offset, wY1 = window.innerHeight;\n\t\n\t\tconst inView = tBottom - hTop < cm.capableWindowHeightRate * (wY1 - wY0);\n\t\tconst tLeft = r.left, tScrollLeft = tab.scrollLeft;\n\t\tif (head) {\n\t\t\tconst hCy = tab.tHead.offsetHeight;\n\t\t\tconst f = (!inView && hTop < wY0 && wY0 < tBottom - hCy);\n\t\t\t_updateHeaderVisibility(head, f, tLeft, tScrollLeft);\n\t\t}\n\t\tif (bar) {\n\t\t\tconst f = (!inView && hBottom < wY1 && wY1 < tBottom);\n\t\t\t_updateBarVisibility(bar, f, tLeft, tScrollLeft);\n\t\t}\n\t}\n\t\n\tfunction _updateHeaderVisibility(head, visible, tabLeft, tabScrollLeft) {\n\t\thead.style.display = visible ? 'block' : 'none';\n\t\thead.style.left    = tabLeft + 'px';\n\t\thead.scrollLeft    = tabScrollLeft;\n\t}\n\t\n\tfunction _updateBarVisibility(bar, visible, tabLeft, tabScrollLeft) {\n\t\tbar.style.display = visible ? 'block' : 'none';\n\t\tbar.style.left    = tabLeft + 'px';\n\t\tbar.scrollLeft    = tabScrollLeft;\n\t}\n\t\n\t\n\t// ---------------------------------------------------------------------\n\t\n\t\n\tfunction onTableScroll(tab, head, cm) {\n\t\tconst sL = Math.max(0, Math.min(tab.scrollLeft, tab.scrollWidth - tab.offsetWidth));  // for iOS\n\t\thead.scrollLeft = sL;\n\t\n\t\tif (tab.scrollWidth - tab.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\tconst r = tab.scrollLeft / (tab.scrollWidth - tab.clientWidth);\n\t\t\tsetClass(head, cm.styleScrollRight, r < 0.95);\n\t\t\tsetClass(head, cm.styleScrollLeft, 0.05 < r);\n\t\t} else {\n\t\t\tsetClass(head, cm.styleScrollRight, false);\n\t\t\tsetClass(head, cm.styleScrollLeft, false);\n\t\t}\n\t}\n\t\n\t\n\t// Utilities ---------------------------------------------------------------\n\t\n\t\n\tfunction getScrollBarWidth(parent) {\n\t\tconst d = document.createElement('div');\n\t\td.setAttribute('style', 'position:absolute;bottom:100%;width:calc(100vw - 100%);height:1px;');\n\t\tparent.appendChild(d);\n\t\tlet width = 0 | window.getComputedStyle(d).getPropertyValue('width');\n\t\n\t\tif (width === 0) {  // Window does not have any scroll bar\n\t\t\td.style.overflowY = 'scroll';\n\t\t\td.style.width = '';\n\t\t\tconst c = document.createElement('div');\n\t\t\tc.style.minHeight = '100px';\n\t\t\td.appendChild(c);\n\t\t\tconst cw = 0 | window.getComputedStyle(c).getPropertyValue('width');\n\t\t\twidth = d.offsetWidth - cw;\n\t\t}\n\t\tparent.removeChild(d);\n\t\treturn width;\n\t}\n\tNS.applyUsableView = apply;\n\n})(window['NACSS']['table']);\n"]}