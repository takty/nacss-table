window.NACSS=window.NACSS||{},function(t){function n(t,n){const e=document.createElement(n);return e.style.display="inline-block",e.style.position="fixed",e.style.visibility="hidden",e.style.whiteSpace="nowrap",t.appendChild(e)}function e(t,n){t.removeChild(n.dcTd),t.removeChild(n.dcTh)}function o(t,n){if(0===t.rows.length)return!1;if(n.maxRowSize<t.rows.length)return!1;const{cellMinWidth:e,cellMinAspect:o}=n;for(const n of t.rows)if(n.hasChildNodes())for(const t of n.childNodes){const n=t.tagName;if("TD"!==n&&"TH"!==n)continue;if(1<parseInt(t.getAttribute("colSpan"),10))continue;if(1<parseInt(t.getAttribute("rowSpan"),10))continue;const i=t.clientWidth,l=t.clientHeight;if(i<e||i/l<o)return!0}return!1}function i(t,n){t.removeAttribute("width"),t.style.display="block",t.style.width="fit-content","fit-content"!==t.style.width&&(t.style.width="-moz-fit-content"),t.style.maxWidth="100%",t.style.overflow="auto";const e=function(t){const n=function(t,n=[]){for(const e of t.rows){const t=[];if(e.hasChildNodes())for(const n of e.childNodes){const e=n.tagName;"TD"!==e&&"TH"!==e||t.push(n)}n.push(t)}return n}(t);let e=0;for(const t of n)e=Math.max(e,t.length);const o=[];for(const t of n)o.push(new Array(e));for(let t=0;t<o.length;t+=1){const i=o[t],l=n[t];let r=0;for(let n=0;n<e;n+=1){if("number"==typeof i[n]||null===i[n])continue;const e=l[r],c=parseInt(e.getAttribute("colSpan")??1,10),s=parseInt(e.getAttribute("rowSpan")??1,10);if(i[n]=e,1<c)for(let t=1;t<c;t+=1)i[n+t]=t;if(1<s)for(let e=1;e<s;e+=1){const i=o[t+e];for(let t=0;t<c;t+=1)i[n+t]=null}if(r+=1,l.length<=r)break}}return o}(t);!function(t,n){for(const e of t)for(let t=0;t<e.length;t+=1){const o=e[t],i=n[t];i&&o instanceof HTMLTableCellElement&&(o.style.whiteSpace=null,o.style.minWidth=i+"px",o.style.width=null)}}(e,function(t,n){for(const n of t)for(const t of n)"number"!=typeof t&&null!==t&&(t.style.whiteSpace="nowrap");const e=t[0].length,o=new Array(e).fill(0),i=new Array(e).fill(0);for(const r of t)for(let t=0;t<e;t+=1){const c=r[t];if(null==c||"number"==typeof c)continue;if(t<e-1&&"number"==typeof r[t+1])continue;if(1<parseInt(c.getAttribute("colSpan"),10))continue;if(1<parseInt(c.getAttribute("rowSpan"),10))continue;const s=l(c,n);o[t]=Math.max(o[t],s),s||(i[t]=Math.max(i[t],c.clientWidth))}return function(t,n,e){const{origTabW:o,origCellWs:i}=e;let l=0,r=0;for(let e=0;e<t.length;e+=1)t[e]?l+=t[e]:r+=n[e];if(o<l+r)return;let c=o-r;for(let n=0;n<t.length;n+=1){if(!t[n])continue;const e=t[n],o=Math.min(e/l*c,i[n]);c-=o-e,l-=o-e,t[n]=0|o}}(o,i,n),o}(e,Object.assign(function(t,n){const e=t.clientWidth,o=[];for(let t=0;t<n[0].length;t+=1)for(let e=0;e<n.length;e+=1){const i=n[e][t];if(i instanceof HTMLTableCellElement&&!i.getAttribute("colSpan")){o.push(i.clientWidth);break}}return{origTabW:e,origCellWs:o}}(t,e),n)))}function l(t,n){const{padH:e,padV:o,charW:i,lineH:l,dcTd:r,dcTh:c,cellMinWidth:s,cellMinAspect:a,cellMinLength:f}=n;if(function(t){const n=t.innerHTML.trim();let e=n.split(/<\s*br\s*\/?>/iu);0===e.length&&(e=[n]);const o=e.map((t=>t.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"").length));return Math.max(...o)}(t)<f)return 0;t.innerHTML=t.innerHTML.trim();const d="TD"===t.tagName?r:c;d.innerHTML=t.innerHTML;const h=d.clientWidth-e,u=Math.round((d.clientHeight-o)/l);let p=0;for(let t=2;;t+=1){const n=0|h/t+i*t+e,r=u*(t*l)+o;if(n<s||n/r<a||p&&p<n)break;p=n}return p+i<d.clientWidth?p:0}window.NACSS.tableNeatWidth=function(t,l={}){if(0===t.length)return;const r=t[t.length-1],c=Object.assign({tableWidthRateForFull:.95,cellMinWidth:80,cellMinAspect:2/3,cellMinLength:8,maxRowSize:200,maxBorderWidth:2,onDoing:null,onDone:null},l,function(t){const n=t.getElementsByTagName("td")[0],e=getComputedStyle(n),o=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),i=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),[l,r]=function(t){const n=document.createElement(t.nodeName);n.setAttribute("style",`position:fixed;margin:0;padding:0;font-family:${t.style.fontFamily||"inherit"};font-size:${t.style.fontSize||"inherit"};`),n.innerHTML="ã€€",t.parentNode.appendChild(n);const e=n.clientWidth,o=n.clientHeight;return n.parentNode.removeChild(n),[e,o]}(n);return{padH:o,padV:i,charW:l,lineH:r}}(r));c.padH+=2*c.maxBorderWidth,c.padV+=2*c.maxBorderWidth,c.dcTd=n(r,"td"),c.dcTh=n(r,"th");const s=[],a=[];for(const n of t)o(n,c)?s.push(n):a.push(n);c.gcCount=s.length;for(const t of s){f((()=>{i(t,c),c.onDone&&c.onDone(t),0==--c.gcCount&&e(r,c)}),!!c.onDoing&&(c.onDoing(t)??0))}if(c.tableWidthRateForFull)for(const t of a){t.parentElement.clientWidth*c.tableWidthRateForFull<t.clientWidth&&(t.style.width="100%")}function f(t,n){!1===n?t():setTimeout(t,n)}}}();
//# sourceMappingURL=table-neat-width.min.js.map
