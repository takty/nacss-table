window.NACSS=window.NACSS||{},function(t){const e="table-enlarged";let i,l;class s{constructor(t){t.style.height&&(t.style.height=""),this._table=t,this._headerHeight=0,this._isEnlarged=!1,this._windowWidth=Math.min(window.outerWidth,window.innerWidth),this._create(),setTimeout((()=>{this._initialize()}),10)}_create(){this._head=this._createHeaderClone(),this._sbar=this._createScrollBarClone(),this._ebtn=t.containStile(this._table,"no-enlarger")?null:this._createEnlargerButton(),this._shade=this._createShade();const e=this._table.getElementsByTagName("caption");this._capt=e.length?e[0]:null}_createHeaderClone(){let i=this._table.tHead;if(!i){if(i=this._createPseudoHeader(),!i)return null;this._table.tHead=i}const l=document.createElement("div");t.addStile(l,"fixed-table-header-container"),this._table.parentNode.appendChild(l);const s=document.createElement("div");t.addStile(s,"fixed-table-header-table"),l.appendChild(s);const n=i.cloneNode(!0);return s.appendChild(n),t.containStile(this._table,e)&&t.addStile(l,e),l}_createPseudoHeader(){const t=this._table.tBodies[0].rows;if(0===t.length)return null;function e(t){const e=t.getElementsByTagName("td"),i=t.getElementsByTagName("th");return 0===e.length&&i.length>0}const i=[];for(let l=0,s=t.length;l<s;l+=1){const s=t[l];if(!e(s))break;i.push(s)}if(0===i.length)return null;const l=this._table.createTHead();for(let t=0;t<i.length;t+=1)l.appendChild(i[t]);return l}_createScrollBarClone(){const e=document.createElement("div");t.addStile(e,"fixed-table-scroll-bar"),this._table.parentNode.appendChild(e);const i=document.createElement("div");return e.appendChild(i),e}_createEnlargerButton(){const t=document.createElement("div");return t.dataset.stile="enlarger-button",this._table.appendChild(t),t}_createShade(){const t=document.createElement("div");return t.dataset.stile="table-shade",this._table.appendChild(t),t}_initialize(){const t=getComputedStyle(this._table).backgroundColor;t&&"transparent"!==t&&(this._table.dataset.background=t),this._initTableScroll(),this._ebtn&&(this._ebtn.addEventListener("click",(()=>{this._isEnlarged?this._turnOffEnlarged():this._turnOnEnlarged()})),this._isEnlargable()||(this._ebtn.style.display="none")),this._resize(),this._adjustUnexpectedScrollBar()}_initTableScroll(){let e=!1,i=!1;this._table.addEventListener("scroll",t.throttle((()=>{e?e=!1:(this._sbar.scrollLeft=this._table.scrollLeft,i=!0),this._onTableScroll()}))),this._sbar.addEventListener("scroll",t.throttle((()=>{i?i=!1:(this._table.scrollLeft=this._sbar.scrollLeft,e=!0)})))}_isScrollable(){const t=this._table;return t.scrollWidth-t.clientWidth>2}_isEnlargable(){const t=this._table,e=Math.min(window.outerWidth,window.innerWidth);return t.scrollWidth-t.offsetWidth>1&&t.offsetWidth<.9*e}_turnOnEnlarged(){const i=this._table;if(i.scrollWidth-i.offsetWidth<=1)return;i.scrollLeft=0,i.style.width="calc(100vw - "+l+"px)",t.addStile(i,e),this._head&&t.addStile(this._head,e),this._isEnlarged=!0;let s=i.getBoundingClientRect().left+window.pageXOffset;const n=i.tBodies[0].clientWidth,a=this._windowWidth-l;n<a&&(s-=(a-n)/2),i.style.marginLeft=-s+"px",i.style.background=null,this._resize()}_turnOffEnlarged(){const i=this._table;i.style.marginLeft="",i.style.width="",i.scrollLeft=0,t.removeStile(i,e),this._head&&t.removeStile(this._head,e),this._isEnlarged=!1,t.removeStile(this._shade,"visible"),this._shade.style.background=null,this._resize()}onWindowResize(){this._adjustUnexpectedScrollBar();const t=Math.min(window.outerWidth,window.innerWidth);this._windowWidth!==t&&(this._windowWidth=t,this._isEnlarged?this._turnOffEnlarged():this._resize())}_adjustUnexpectedScrollBar(){const t=this._table;t.style.overflowX=t.scrollWidth<t.clientWidth+2?"hidden":""}_resize(){this._head&&this._updateHeaderSize(this._head),this._sbar&&this._updateScrollBarSize(this._sbar),(this._head||this._sbar)&&this.onWindowScroll(),this._onTableScroll()}_updateHeaderSize(t){t.style.maxWidth=this._table.getBoundingClientRect().width+"px",t.style.display="none",t.style.top=i()+"px";const e=this._table.tHead;let l=e.getBoundingClientRect().width;const s=t.firstChild;s.style.width=l+"px";const n=s.firstChild,a=e.rows,h=n.rows;for(let t=0;t<a.length;t+=1)r(a[t],h[t],"td"),r(a[t],h[t],"th");function r(t,e,i){const l=t.getElementsByTagName(i),s=e.getElementsByTagName(i);for(let t=0;t<l.length;t+=1)s[t].style.width=l[t].getBoundingClientRect().width+"px"}this._headerHeight=e.getBoundingClientRect().height}_updateScrollBarSize(t){t.style.maxWidth=this._table.clientWidth+"px",t.style.display="none";const e=parseInt(n());0<e&&(t.style.height=e+2+"px");const i=this._table.tBodies[0];t.firstChild.style.width=Math.ceil(i.clientWidth)+"px"}onWindowScroll(){const t=this._table.getBoundingClientRect(),e=t.top,l=t.bottom,s=i(),n=this._capt?this._capt.offsetHeight:0,a=this._headerHeight,h=l-e-n<.9*(window.innerHeight-s);let r=!1;h||s<e+n||l-a<s||e+n<s&&(r=!0);let d=!1;h||window.innerHeight<e+n+a||l<window.innerHeight||this._isScrollable()&&(d=!0),this._head&&this.updateHeaderVisibility(r,t.left),this._sbar&&this.updateScrollBarVisibility(d,t.left)}updateHeaderVisibility(t,e){const l=this._head;t?(l.style.top=i()+"px",l.style.display="block",this._ebtn&&l&&this.switchEnlargerToFloatingHeader()):(l.style.display="none",this._ebtn&&l&&this.switchEnlargerToTable()),l.style.left=e+"px",l.scrollLeft=this._table.scrollLeft}switchEnlargerToTable(){this._ebtn.parentNode.removeChild(this._ebtn),this._ebtn.style.top=this._capt?this._capt.offsetHeight+"px":0,this._table.appendChild(this._ebtn)}switchEnlargerToFloatingHeader(){this._ebtn.parentNode.removeChild(this._ebtn),this._ebtn.style.top=0,this._head.appendChild(this._ebtn)}updateScrollBarVisibility(t,e){const i=this._sbar;i.style.display=t?"block":"none",i.style.left=e+"px",i.scrollLeft=this._table.scrollLeft}_onTableScroll(){const e=this._table,i=this._head,l=this._capt,s=this._ebtn,n=this._shade,a=Math.max(0,Math.min(e.scrollLeft,e.scrollWidth-e.offsetWidth));i&&(i.scrollLeft=a),l&&(this._isScrollable()?(this._stCapt&&clearTimeout(this._stCapt),this._stCapt=setTimeout((()=>{l.style.transform=`translateX(${a}px)`}),200)):l.style.transform=null),s&&(t.removeStile(s,"visible"),this._stEbtn&&clearTimeout(this._stEbtn),this._stEbtn=setTimeout((()=>{t.addStile(s,"visible")}),100),this._updateEnlager()),this._isEnlarged&&(t.removeStile(n,"visible"),this._isScrollable()&&this._isEnlarged&&(this._stShade&&clearTimeout(this._stShade),this._stShade=setTimeout((()=>{n.style.transform=`translateX(${a}px)`,t.addStile(n,"visible")}),100))),this._updateShade()}_updateEnlager(){const t=this._table,e=this._capt,i=this._ebtn,l=t.scrollLeft,s=this._table.tBodies[0].clientWidth,n=t.clientWidth;if(this._isEnlargable()||this._isEnlarged){let a=-Math.min(s-n,l);if(!this._isEnlargable()&&this._isEnlarged){const t=i.parentElement.clientWidth-s;0<t&&(a=t)}i.parentNode===t&&(i.style.top=e?e.offsetHeight+"px":0),i.style.right=a+"px",i.style.display="block"}else i.style.display="none"}_updateShade(){const t=this._table,e=this._shade;if(this._isScrollable()){const i=this._calcShadeStyle();this._isEnlarged?e.style.background=i:t.style.background=i}else t.style.background=""}_calcShadeStyle(){const t=this._table,e=t.scrollLeft/(t.scrollWidth-t.clientWidth);let i=.25,l=.25;e<.1&&(i*=e/.1),.9<e&&(l*=(1-e)/.1);const s=this._capt?this._capt.offsetHeight+"px":"0",n=`linear-gradient(to left, rgba(0,0,0,0), rgba(0,0,0,${i}) 1.25rem) 0 ${s} / 1.25rem 100% no-repeat scroll`,a=`linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,${l}) 1.25rem) right ${s} / 1.25rem 100% no-repeat scroll`,h=this._table.dataset.background;return n+","+a+(this._isEnlarged||!h||"transparent"===h?"":`, linear-gradient(to bottom, ${h}, ${h}) 0px 0px / 100% 100% no-repeat`)}}function n(){const t=document.createElement("div");t.style.bottom="100%",t.style.height="1px",t.style.position="absolute",t.style.width="calc(100vw - 100%)",document.body.appendChild(t);let e=0|window.getComputedStyle(t,"").getPropertyValue("width");if(0===e){t.style.overflowY="scroll",t.style.width="";const i=document.createElement("div");i.style.minHeight="100px",t.appendChild(i);const l=0|window.getComputedStyle(i,"").getPropertyValue("width");e=t.offsetWidth-l}return document.body.removeChild(t),e}t.tableFixedHeader=function(e){l=parseInt(n());const i=[];for(let t=0;t<e.length;t+=1)i.push(new s(e[t]));t.onScroll((()=>{for(let t=0;t<i.length;t+=1)i[t].onWindowScroll()})),t.onResize((()=>{for(let t=0;t<i.length;t+=1)i[t].onWindowResize()}))}}(window.NACSS);
//# sourceMappingURL=table-fixed-header.min.js.map
